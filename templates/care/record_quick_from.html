{% extends "base.html" %}
{% load static %}
{% block title %}Novo Registro ‚Ä¢ CuidarJuntos{% endblock %}

{% block content %}
<div class="flex items-center gap-3 mb-4">
  <a href="{% url 'care:record-list' %}" class="px-3 py-2 border rounded-lg hover:bg-gray-50">‚óÄ Registros</a>
  <a href="{% url 'care:dashboard' %}" class="px-3 py-2 border rounded-lg hover:bg-gray-50">üìä Dashboard</a>
</div>

<!-- Grade de categorias -->
<div class="bg-white border rounded-xl p-5 mb-6">
  <h2 class="text-xl font-semibold mb-4">Selecione a Categoria</h2>

  {% url 'care:record-create' as new_url %}
  <!-- 2 colunas no mobile (3 em telas m√©dias) + cards compactos -->
  <ul class="grid grid-cols-2 gap-3 sm:grid-cols-3 sm:gap-4">
    {% for value,label in categories %}
      <li>
        <a href="{{ new_url }}?category={{ value }}"
           class="group block rounded-xl border bg-white focus:outline-none focus:ring-2 focus:ring-blue-300
                  p-3 sm:p-4 h-28 sm:h-32 flex flex-col items-center justify-center select-none touch-manipulation
                  {% if selected_category == value %} ring-2 ring-blue-500 bg-blue-50 border-blue-200 {% else %} hover:shadow-sm {% endif %}">
          <span class="text-3xl sm:text-4xl mb-1">
            {% if value == 'medication' %}üíä{% elif value == 'sleep' %}üåô
            {% elif value == 'meal' %}üçΩÔ∏è{% elif value == 'bathroom' %}üöΩ
            {% elif value == 'activity' %}üèÉ{% elif value == 'vital' %}‚ù§Ô∏è{% else %}‚ûï{% endif %}
          </span>
          <span class="text-sm sm:text-base font-medium text-center leading-tight">{{ label }}</span>
        </a>
      </li>
    {% endfor %}
  </ul>
</div>

<!-- Formul√°rio -->
<div class="bg-white border rounded-xl p-5">
  <h3 class="text-lg font-semibold mb-4">
    Registrar {% for v,l in categories %}{% if v == selected_category %}{{ l }}{% endif %}{% endfor %}
  </h3>

  {% if current_patient %}
    <p class="text-sm text-gray-600 mb-4">Paciente: <strong>{{ current_patient.name }}</strong></p>
  {% endif %}

  <form method="post" class="space-y-4">
    {% csrf_token %}
    {{ form.non_field_errors }}

    {{ form.patient }} {# escondido #}

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm mb-1">Data</label>
        {{ form.date }}
        {{ form.date.errors }}
      </div>
      <div>
        <label class="block text-sm mb-1">Hor√°rio</label>
        {{ form.time }}
        {{ form.time.errors }}
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm mb-1">Categoria</label>
        {{ form.type }}
        {{ form.type.errors }}
      </div>
      <div>
        <label class="block text-sm mb-1">
          {% if selected_category == 'medication' %}Medicamento/Dose
            {% elif selected_category == 'meal' %}Refei√ß√£o
            {% elif selected_category == 'sleep' %}Per√≠odo/Qualidade
            {% elif selected_category == 'bathroom' %}Tipo (Urina/Evacua√ß√£o)
            {% elif selected_category == 'activity' %}Atividade
            {% elif selected_category == 'vital' %}Sinal (PA, glicemia, temperatura‚Ä¶)
            {% else %}Tipo / Detalhe
            {% endif %}
        </label>
        {{ form.what }}
        {{ form.what.errors }}
      </div>
    </div>

    <div>
      <label class="block text-sm mb-1">Observa√ß√µes</label>
      {{ form.description }}
      {{ form.description.errors }}
    </div>

    {% if form.show_progress_trend %}
      <div>
        <label class="block text-sm mb-2">Classifique como:</label>
        {{ form.progress_trend.errors }}
        <ul class="flex gap-3">
          {% for rb in form.progress_trend %}
            <li>
              <label class="inline-flex items-center gap-2 rounded-lg border px-3 py-2 cursor-pointer hover:bg-gray-50">
                {{ rb.tag }}
                <span>{{ rb.choice_label }}</span>
              </label>
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}

    <button class="w-full bg-blue-600 text-white rounded-lg py-3 font-medium hover:bg-blue-700">
      Registrar Atividade
    </button>
  </form>
</div>
{% endblock %}
